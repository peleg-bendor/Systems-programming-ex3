# תרגיל בית מס' 3 (תרגיל תכנות): בניית מפרש פקודות ( Bash Shell-Mini) 

## מבוא ומטרות התרגיל : 

ה- Shell הוא התוכנה שמקשרת בין המשתמש לבין ליבת מערכת ההפעלה (Kernel). בתרגיל זה תכתבו מפרש פקודות משלכם בשפת C. המטרה היא להבין כיצד מערכת ההפעלה מנהלת תהליכים (Processes), כיצד ה-Kernel מייצר עותקים של תוכניות וכיצד תהליכים מתקשרים וממתינים זה לזה.  

האתגר המרכזי: עבודה ישירה מול ה-Kernel באמצעות קריאות מערכת (System Calls) בלבד.  

## סביבת עבודה נדרשת: 

1. מערכת הפעלה: Windows. או מערכת ההפעלה MacOS. 
2. סביבת פיתוח (במקרה שמערכת ההפעלה שלכם היא Windows:) WSL עם התקנת Ubuntu (גרסת CLI – אין צורך בממשק גרפי). 
3. מהדר (Compiler): gcc (המהדר הסטנדרטי של C בלינוקס). 
4. כלי עזר: bash terminal.

**הערה: אין להשתמש בספריות גרפיות.**

## מבנה הלוגיקה המרכזית (The Shell Loop) 

התוכנית שלכם צריכה לפעול בלולאה אינסופית שמדמה את מחזור החיים של Bash: 

1. הצגת Prompt: הדפסת מחרוזת קבועה (למשל mini-bash$ ) המודיעה למשתמש שהמערכת מוכנה לקלט.  
2. קריאת פקודה (Read): קליטת שורת הטקסט שהמשתמש הקליד.  
3. ניתוח (Parse): פירוק השורה למילים (Tokens). לדוגמה, אם המשתמש הקליד ls -l /home ,עליכם להפריד זאת למערך שבו המילה הראשונה היא הפקודה והשאר הם הארגומנטים.  

**הערה:** המפרידים הם רווחים (' ') או טאבים ('\t .)' 

4. זיהוי וביצוע (Execute): החלטה האם מדובר בפקודה "פנימית" או "חיצונית" וביצועה.  

## פקודות פנימיות (Internal Commands) 

פקודות פנימיות הן פקודות שה- Shell מבצע בעצמו, מבלי "לבקש" מה- Kernel להריץ קובץ חיצוני. עליכם לממש:  

- exit: יציאה מהלולאה וסיום התוכנית.  
- cd: שינוי תיקיית העבודה. 

למה זה פנימי? מכיוון ששינוי תיקייה חייב להתבצע בתוך התהליך של ה-Shell עצמו כדי שישפיע על הפקודות הבאות. השתמשו בקריאת המערכת chdir() . 

## פקודות חיצוניות ומנגנון החיפוש  

עבור כל פקודה אחרת, ה- Shell מניח שקיימת תוכנית (קובץ) במערכת שיודעת לבצע אותה. 

עליכם לחפש את הקובץ בסדר הבא: 

### שלב א': חיפוש בתיקיית הבית (Home Directory ) 

1. עליכם לזהות מהי תיקיית הבית של המשתמש הנוכחי (רמז: בדקו את משתנה הסביבה HOME .) 
2. בדקו האם קיים בתיקייה זו קובץ ששמו זהה לשם הפקודה שהוקלדה. 
3. תנאי הכרחי: עליכם לוודא שהקובץ הוא "בר-ביצוע" (Executable). לא מספיק שהוא קיים.  
4. אם נמצא קובץ מתאים – הריצו אותו.  

### שלב ב': חיפוש בתיקיית /bin 

1. אם לא מצאתם קובץ מתאים בתיקיית הבית, עליכם לחפש אותו בתיקייה /bin (שם נמצאות רוב פקודות המערכת כמו ls, cp, cat .) 
2. אם נמצא קובץ מתאים – הריצו אותו.  

### שלב ג': הודעת שגיאה 

אם הפקודה לא נמצאה באף אחד מהמקומות: 

    הדפיסו הודעה בפורמט: [command_name]: Unknown Command ] 

## הרצה באמצעות ניהול תהליכים (Process Management) 

כדי להריץ פקודה חיצונית, עליכם ליישם את המנגנון הבא: 

1. יצירת תהליך בן (forkה :)- Shell מייצר עותק של עצמו.  
1. החלפת התוכנית המשויכת לתהליך הבן (exec): בתהליך הבן, תשתמשו בקריאת מערכת ממשפחת ה-exec כדי לטעון ולהריץ את הקובץ שנמצא (בתיקיית הבית או ב- /bin.) 
1. המתנה של תהליך האב לסיום ריצת תהליך הבן (wait): תהליך האב (ה- Shell שלכם) חייב להמתין עד שתהליך הבן יסיים את פעולתו.  
1. דיווח: לאחר סיום תהליך הבן, ה- Shell ידפיס הודעה שהפקודה בוצעה בהצלחה ויציג את ה -Return Code (ערך החזרה) של התוכנית שרצה. 
1. טיפול בכשלים: אם ה-exec נכשל (למשל, אין הרשאות הרצה), עליכם להשתמש ב- perror() כדי להדפיס את השגיאה המדויקת מה- Kernel . 

## דגשים טכניים ויעילות  

- שימוש ב-Buffers: עליכם לנהל את הזיכרון של התוכנית **ביעילות**. 

הקצאת ה- Buffer לקריאת הקלט והטיפול במחרוזות צריכים להיות **יעילים**. הימנעו מהעתקות מיותרות של טקסט בזיכרון  !! 

- איסור על Threads: התרגיל מתמקד בתהליכים (Processes). אין להשתמש בחוטים (Threads  ) **כלל**. 
- קריאות מערכת: המטרה היא ללמוד את ה-API של ה-Kernel. אל תשתמשו בפונקציות "עוטפות" ברמה גבוהה (כמו system()), אלא רק בקריאות מערכת בסיסיות

## דרישות תיעוד והגשה: 

1. תיעוד קוד (Comments:) 

   - חובה לכלול הערות (Comments) מקיפות בתוך קוד המקור (C.) 
   - ההערות צריכות לתאר את הלוגיקה של חלקים מורכבים, להסביר את השימוש בכל System Call, ואת משמעות הערכים המוחזרים.  
1. מבנה הגשה (GitHub:) 

   - יש ליצור Repository חדש ב-GitHub. 
   - הרשאות: ודאו כי ה-Repository הוא ציבורי (Public) או שהרשאות הגישה מאפשרות לכל אדם שיש ברשותו הקישור (הבודק) לגשת לקבצים. 
   - קבצים להעלאה:
       - mini_bash.c (קובץ קוד המקור). 
       - Makefile (אם יש). 
   - קובץ הרצה (executable) בשם mini_bash.  
   - קישור: יש להוסיף  את הקישור המלא ל-Repository למסך הנלווה.
1. מסמך נלווה (Design Document :) **חובה** להגיש מסמך המתאר לפרטי פרטים את התכנון ואת הלוגיקה של התוכנית.  

תוכן נדרש: 

- ניתוח System Calls: פירוט קריאות המערכת שבהן השתמשתם וכיצד כל קריאה מומשה. 
- לוגיקת זרימה (Flow): תרשים זרימה (Flowchart) או תיאור מילולי מפורט של שלבי התוכנית  
- הוכחה לכך שהפתרון הוא יעיל מבחינת מספר System Calls . 
- טיפול בשגיאות: פירוט כיצד התוכנית מזהה ומטפלת בשגיאות System Calls.  

*את המסמך יש להעלות לאתר הקורס*. 